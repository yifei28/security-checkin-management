# ğŸ”„ å‰ç«¯ç­¾åˆ°è®°å½•åŠŸèƒ½å‡çº§ - APIé›†æˆæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

å‰ç«¯ç­¾åˆ°è®°å½•åŠŸèƒ½å·²å®Œæˆé‡å¤§å‡çº§ï¼Œé‡‡ç”¨ç°ä»£åŒ–UIè®¾è®¡å’Œå¢å¼ºçš„æ•°æ®ç»“æ„ã€‚æœ¬æ–‡æ¡£ä¸ºåç«¯å·¥ç¨‹å¸ˆæä¾›è¯¦ç»†çš„APIæ¥å£è§„èŒƒï¼Œç¡®ä¿å‰åç«¯æ•°æ®æ ¼å¼ä¸€è‡´ã€‚

---

## ğŸ†• æ–°åŠŸèƒ½ç‰¹æ€§

### âœ¨ åŠŸèƒ½å¢å¼º
- **å¤šç»´åº¦ç­›é€‰**: æŒ‰çŠ¶æ€ã€ä¿å®‰ã€ç«™ç‚¹ã€æ—¶é—´èŒƒå›´ç­›é€‰
- **æ™ºèƒ½æœç´¢**: æ”¯æŒä¿å®‰å§“åã€æ‰‹æœºå·ã€ç«™ç‚¹åç§°å…¨æ–‡æœç´¢
- **è·ç¦»éªŒè¯**: è‡ªåŠ¨è®¡ç®—ç­¾åˆ°ä½ç½®ä¸ç«™ç‚¹çš„è·ç¦»ï¼Œæ ‡è®°å¼‚å¸¸ç­¾åˆ°
- **çŠ¶æ€ç®¡ç†**: æ”¯æŒæˆåŠŸ/å¤±è´¥/å¾…å¤„ç†ä¸‰ç§ç­¾åˆ°çŠ¶æ€
- **ç»Ÿè®¡é¢æ¿**: å®æ—¶æ˜¾ç¤ºç­¾åˆ°ç»Ÿè®¡æ•°æ®
- **äººè„¸éªŒè¯**: æ”¯æŒäººè„¸ç…§ç‰‡å­˜å‚¨å’Œé¢„è§ˆ

### ğŸ¨ UIæ”¹è¿›
- ç°ä»£åŒ–çš„å¡ç‰‡å¼å¸ƒå±€
- çŠ¶æ€å¾½ç« å’Œå›¾æ ‡
- å“åº”å¼è®¾è®¡
- åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†

---

## ğŸ”Œ APIæ¥å£è§„èŒƒ

### 1. ç­¾åˆ°è®°å½•åˆ—è¡¨ API

#### **æ¥å£åœ°å€**
```http
GET /api/checkin
```

#### **å½“å‰è¿”å›æ ¼å¼ï¼ˆéœ€è¦æ›´æ–°ï¼‰**
```json
[
  {
    "id": 1,
    "guardName": "å¼ ä¸‰",
    "phoneNumber": "13800138001",
    "timestamp": "2024-01-15T08:30:00Z",
    "latitude": 39.9042,
    "longitude": 116.4074,
    "period": "æ—©ç­"
  }
]
```

#### **âœ… æ–°çš„æ ‡å‡†è¿”å›æ ¼å¼**
```json
{
  "success": true,
  "data": [
    {
      "id": "checkin_001",
      "guardId": "guard_001", 
      "siteId": "site_001",
      "timestamp": "2024-01-15T08:30:00.000Z",
      "location": {
        "lat": 39.9042,
        "lng": 116.4074
      },
      "faceImageUrl": "https://example.com/images/face_001.jpg",
      "status": "success",
      "reason": null
    },
    {
      "id": "checkin_002", 
      "guardId": "guard_002",
      "siteId": "site_001",
      "timestamp": "2024-01-15T08:35:00.000Z",
      "location": {
        "lat": 39.9045,
        "lng": 116.4078
      },
      "faceImageUrl": "https://example.com/images/face_002.jpg", 
      "status": "failed",
      "reason": "äººè„¸è¯†åˆ«å¤±è´¥"
    }
  ],
  "total": 156,
  "page": 1,
  "pageSize": 50
}
```

### 2. ä¿å®‰ä¿¡æ¯ API

#### **æ¥å£åœ°å€**
```http
GET /api/guards
```

#### **âœ… æœŸæœ›è¿”å›æ ¼å¼**
```json
{
  "success": true,
  "data": [
    {
      "id": "guard_001",
      "name": "å¼ ä¸‰",
      "phoneNumber": "13800138001", 
      "employeeId": "EMP001",
      "site": {
        "id": "site_001",
        "name": "ä¸œé—¨å²—ä½"
      },
      "isActive": true,
      "createdAt": "2024-01-01T00:00:00.000Z"
    }
  ]
}
```

### 3. ç«™ç‚¹ä¿¡æ¯ API

#### **æ¥å£åœ°å€**
```http
GET /api/sites
```

#### **âœ… æœŸæœ›è¿”å›æ ¼å¼**
```json
{
  "success": true,
  "data": [
    {
      "id": "site_001",
      "name": "ä¸œé—¨å²—ä½",
      "latitude": 39.9042,
      "longitude": 116.4074,
      "allowedRadiusMeters": 100,
      "assignedGuardIds": ["guard_001", "guard_002"],
      "isActive": true,
      "createdAt": "2024-01-01T00:00:00.000Z"
    }
  ]
}
```

---

## ğŸ“Š æ•°æ®ç±»å‹è§„èŒƒ

### CheckInStatus ç­¾åˆ°çŠ¶æ€æšä¸¾
```typescript
type CheckInStatus = 'success' | 'failed' | 'pending';
```

| çŠ¶æ€å€¼ | å«ä¹‰ | å‰ç«¯æ˜¾ç¤º | é¢œè‰² |
|--------|------|----------|------|
| `success` | ç­¾åˆ°æˆåŠŸ | âœ… æˆåŠŸ | ç»¿è‰² |
| `failed` | ç­¾åˆ°å¤±è´¥ | âŒ å¤±è´¥ | çº¢è‰² |
| `pending` | å¾…å¤„ç† | â³ å¾…å¤„ç† | é»„è‰² |

### Location ä½ç½®ä¿¡æ¯
```typescript
interface Location {
  lat: number;  // çº¬åº¦ -90 åˆ° 90
  lng: number;  // ç»åº¦ -180 åˆ° 180
}
```

### é‡è¦å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `id` | string | âœ… | ç­¾åˆ°è®°å½•å”¯ä¸€ID |
| `guardId` | string | âœ… | ä¿å®‰IDï¼Œç”¨äºå…³è”ä¿å®‰ä¿¡æ¯ |
| `siteId` | string | âœ… | ç«™ç‚¹IDï¼Œç”¨äºå…³è”ç«™ç‚¹ä¿¡æ¯ |
| `timestamp` | string | âœ… | ISO 8601æ ¼å¼çš„æ—¶é—´æˆ³ |
| `location` | object | âœ… | GPSåæ ‡å¯¹è±¡ |
| `faceImageUrl` | string | âŒ | äººè„¸ç…§ç‰‡URLï¼Œå¯é€‰ |
| `status` | enum | âœ… | ç­¾åˆ°çŠ¶æ€æšä¸¾å€¼ |
| `reason` | string | âŒ | å¤±è´¥åŸå› ï¼Œä»…åœ¨statusä¸ºfailedæ—¶å¡«å†™ |

---

## ğŸ” å‰ç«¯ç­›é€‰åŠŸèƒ½è¯´æ˜

å‰ç«¯ä¼šæ ¹æ®ä»¥ä¸‹å‚æ•°è¿›è¡Œå®¢æˆ·ç«¯ç­›é€‰ï¼š

### 1. æœç´¢åŠŸèƒ½
- **æœç´¢èŒƒå›´**: ä¿å®‰å§“åã€æ‰‹æœºå·ã€ç«™ç‚¹åç§°
- **æœç´¢æ–¹å¼**: åŒ…å«åŒ¹é…ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰

### 2. çŠ¶æ€ç­›é€‰
- `all`: æ˜¾ç¤ºæ‰€æœ‰çŠ¶æ€
- `success`: ä»…æ˜¾ç¤ºæˆåŠŸç­¾åˆ°
- `failed`: ä»…æ˜¾ç¤ºå¤±è´¥ç­¾åˆ°  
- `pending`: ä»…æ˜¾ç¤ºå¾…å¤„ç†ç­¾åˆ°

### 3. æ—¶é—´èŒƒå›´ç­›é€‰
- `today`: ä»Šå¤©çš„è®°å½•
- `week`: æœ€è¿‘ä¸€å‘¨çš„è®°å½•
- `month`: æœ€è¿‘ä¸€æœˆçš„è®°å½•
- `all`: å…¨éƒ¨æ—¶é—´çš„è®°å½•

### 4. ä¿å®‰/ç«™ç‚¹ç­›é€‰
- æ ¹æ® `guardId` å’Œ `siteId` è¿›è¡Œç²¾ç¡®ç­›é€‰

---

## ğŸ¯ è·ç¦»éªŒè¯é€»è¾‘

å‰ç«¯ä¼šè‡ªåŠ¨è®¡ç®—ç­¾åˆ°ä½ç½®ä¸ç«™ç‚¹ä½ç½®çš„è·ç¦»ï¼š

```typescript
// è·ç¦»è®¡ç®—å…¬å¼ï¼ˆHaversineå…¬å¼ï¼‰
function calculateDistance(
  lat1: number, lng1: number,  // ç­¾åˆ°ä½ç½®
  lat2: number, lng2: number   // ç«™ç‚¹ä½ç½®
): number {
  // è¿”å›è·ç¦»ï¼ˆå•ä½ï¼šç±³ï¼‰
}

// å¼‚å¸¸åˆ¤æ–­é€»è¾‘
if (distance > site.allowedRadiusMeters) {
  // æ ‡è®°ä¸º"è·ç¦»å¼‚å¸¸"
}
```

**å»ºè®®**ï¼šåç«¯ä¹Ÿå¯ä»¥åœ¨ç­¾åˆ°æ—¶è¿›è¡Œè·ç¦»éªŒè¯ï¼Œè‡ªåŠ¨è®¾ç½® `status` ä¸º `failed`ï¼Œ`reason` ä¸º"ç­¾åˆ°ä½ç½®è¶…å‡ºå…è®¸èŒƒå›´"ã€‚

---

## ğŸ”§ é”™è¯¯å¤„ç†

### HTTPçŠ¶æ€ç å¤„ç†
```typescript
// å‰ç«¯é”™è¯¯å¤„ç†é€»è¾‘
switch (response.status) {
  case 200: // æˆåŠŸ
  case 401: // æœªæˆæƒ - è‡ªåŠ¨è·³è½¬ç™»å½•
  case 403: // ç¦æ­¢è®¿é—® - æ˜¾ç¤ºæƒé™é”™è¯¯
  case 404: // èµ„æºä¸å­˜åœ¨ - æ˜¾ç¤ºå‹å¥½æç¤º
  case 500: // æœåŠ¡å™¨é”™è¯¯ - æ˜¾ç¤ºæŠ€æœ¯é”™è¯¯ä¿¡æ¯
}
```

### APIé”™è¯¯å“åº”æ ¼å¼
```json
{
  "success": false,
  "error": {
    "code": "INVALID_PARAMETER",
    "message": "ç­¾åˆ°å‚æ•°æ— æ•ˆ",
    "details": "ç»çº¬åº¦åæ ‡è¶…å‡ºæœ‰æ•ˆèŒƒå›´"
  }
}
```

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. åˆ†é¡µæ”¯æŒ
```http
GET /api/checkin?page=1&pageSize=50&sortBy=timestamp&sortOrder=desc
```

### 2. å­—æ®µç­›é€‰
```http
GET /api/checkin?fields=id,guardId,siteId,timestamp,status
```

### 3. ç¼“å­˜ç­–ç•¥
- ä¿å®‰å’Œç«™ç‚¹ä¿¡æ¯å¯ä»¥ç¼“å­˜è¾ƒé•¿æ—¶é—´
- ç­¾åˆ°è®°å½•å»ºè®®ç¼“å­˜5-10åˆ†é’Ÿ

### 4. æ‰¹é‡æ“ä½œ
```http
GET /api/checkin/batch?guardIds=guard_001,guard_002&startDate=2024-01-01
```

---

## ğŸ“‹ æµ‹è¯•æ•°æ®ç¤ºä¾‹

```json
{
  "success": true,
  "data": [
    {
      "id": "checkin_20240115_001",
      "guardId": "guard_zhangsan",
      "siteId": "site_dongmen", 
      "timestamp": "2024-01-15T08:30:15.123Z",
      "location": {
        "lat": 39.904211,
        "lng": 116.407395
      },
      "faceImageUrl": "https://cdn.example.com/faces/20240115_zhangsan_001.jpg",
      "status": "success",
      "reason": null
    },
    {
      "id": "checkin_20240115_002",
      "guardId": "guard_lisi", 
      "siteId": "site_ximen",
      "timestamp": "2024-01-15T08:35:42.456Z",
      "location": {
        "lat": 39.903845,
        "lng": 116.406123
      },
      "faceImageUrl": null,
      "status": "failed", 
      "reason": "è·ç¦»ç«™ç‚¹è¿‡è¿œï¼ˆå®é™…è·ç¦»ï¼š245ç±³ï¼‰"
    },
    {
      "id": "checkin_20240115_003",
      "guardId": "guard_wangwu",
      "siteId": "site_nanmen", 
      "timestamp": "2024-01-15T08:40:18.789Z",
      "location": {
        "lat": 39.905123,
        "lng": 116.408567
      },
      "faceImageUrl": "https://cdn.example.com/faces/20240115_wangwu_003.jpg",
      "status": "pending",
      "reason": "äººè„¸è¯†åˆ«å¤„ç†ä¸­"
    }
  ],
  "pagination": {
    "total": 1847,
    "page": 1,
    "pageSize": 50,
    "totalPages": 37
  }
}
```

---

## âœ… è¿ç§»æ£€æŸ¥æ¸…å•

### åç«¯å¼€å‘ä»»åŠ¡
- [ ] æ›´æ–°ç­¾åˆ°è®°å½•APIè¿”å›æ ¼å¼
- [ ] æ·»åŠ  `status` å­—æ®µå’ŒçŠ¶æ€ç®¡ç†é€»è¾‘
- [ ] å®ç° `faceImageUrl` äººè„¸ç…§ç‰‡å­˜å‚¨
- [ ] æ·»åŠ è·ç¦»éªŒè¯é€»è¾‘
- [ ] ä¼˜åŒ–ä¿å®‰å’Œç«™ç‚¹APIè¿”å›æ ¼å¼
- [ ] æ·»åŠ åˆ†é¡µå’Œæ’åºæ”¯æŒ
- [ ] å®ç°é”™è¯¯å¤„ç†æ ‡å‡†åŒ–

### å‰ç«¯é€‚é…ä»»åŠ¡  
- [x] æ›´æ–°æ•°æ®æ¥å£ç±»å‹å®šä¹‰
- [x] å®ç°æ–°çš„UIç»„ä»¶å’Œå¸ƒå±€
- [x] æ·»åŠ ç­›é€‰å’Œæœç´¢åŠŸèƒ½
- [x] å®ç°è·ç¦»è®¡ç®—é€»è¾‘
- [x] æ·»åŠ é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€
- [ ] æ·»åŠ åˆ†é¡µåŠŸèƒ½
- [ ] å®ç°å®æ—¶æ•°æ®åˆ·æ–°

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰ä»»ä½•APIæ¥å£ç›¸å…³é—®é¢˜ï¼Œè¯·è”ç³»å‰ç«¯å¼€å‘å›¢é˜Ÿï¼š

- **æŠ€æœ¯è´Ÿè´£äºº**: å‰ç«¯å¼€å‘å·¥ç¨‹å¸ˆ
- **æ–‡æ¡£æ›´æ–°**: 2024å¹´1æœˆ15æ—¥
- **ç‰ˆæœ¬**: v2.0

---

## ğŸ¯ æ€»ç»“

è¿™æ¬¡å‡çº§å°†å¤§å¤§æå‡ç­¾åˆ°è®°å½•ç®¡ç†çš„ç”¨æˆ·ä½“éªŒå’ŒåŠŸèƒ½å®Œæ•´æ€§ã€‚æŒ‰ç…§æœ¬æ–‡æ¡£çš„APIè§„èŒƒè¿›è¡Œå¼€å‘ï¼Œå¯ä»¥ç¡®ä¿å‰åç«¯å®Œç¾åä½œï¼Œä¸ºç”¨æˆ·æä¾›ç°ä»£åŒ–çš„ç®¡ç†ç•Œé¢ã€‚

**å…³é”®ç‚¹**ï¼š
1. âœ… ä½¿ç”¨æ–°çš„æ•°æ®ç»“æ„ï¼ˆCheckInRecordæ¥å£ï¼‰
2. âœ… æ”¯æŒä¸‰ç§ç­¾åˆ°çŠ¶æ€ï¼ˆsuccess/failed/pendingï¼‰
3. âœ… æä¾›è¯¦ç»†çš„ä½ç½®ä¿¡æ¯å’Œè·ç¦»éªŒè¯
4. âœ… æ”¯æŒäººè„¸ç…§ç‰‡å­˜å‚¨å’Œé¢„è§ˆ
5. âœ… æ ‡å‡†åŒ–çš„é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼

æœŸå¾…ä¸åç«¯å›¢é˜Ÿçš„ç´§å¯†åˆä½œï¼ğŸ¤